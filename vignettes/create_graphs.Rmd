---
title: "Create Graphs"
author: "Julie Le Borgne"
date: "25/05/2020"
output: html_document
---



```{r}
library(SMCA)
library(ggpubr)
library(ggplot2)
library(tidyverse)
library(ggrepel)
```

```{r}
data(cheese)

```

On crée une partition des individus sur les villes et des modalités sur les variables. 

```{r}

Gvar <- partition_variables(cheese)
# vect <- sample(c("a", "b"), size = ncol(cheese), replace = T)
# Gvar <- partition_select(vect, cheese, choice = "var")
Gcity <- partition_select (cheese [,3])

```

```{r}

j <- length(unlist(Gvar))
i <- nrow(cheese)
c1 <- c(1, 0.5*sqrt(i), sqrt(i))
c2 <- c(1, 0.5*sqrt(j), sqrt(j))

```

L'ensemble des essais avec une groupement sur les villes
```{r}
res.1.1.city <- SMCA(cheese, c1 = c1[1], c2 = c2[1], Gcol = Gvar, Grow = Gcity, n = 10, init="svd")
res.1.2.city <- SMCA(cheese, c1 = c1[1], c2 = c2[2], Gcol = Gvar, Grow = Gcity, n = 10, init="svd")
res.1.3.city <- SMCA(cheese, c1 = c1[1], c2 = c2[3], Gcol = Gvar, Grow = Gcity, n = 10, init="svd")
res.2.1.city <- SMCA(cheese, c1 = c1[2], c2 = c2[1], Gcol = Gvar, Grow = Gcity, n = 10, init="svd")
res.2.2.city <- SMCA(cheese, c1 = c1[2], c2 = c2[2], Gcol = Gvar, Grow = Gcity, n = 10, init="svd")
res.2.3.city <- SMCA(cheese, c1 = c1[2], c2 = c2[3], Gcol = Gvar, Grow = Gcity, n = 10, init="svd")
res.3.1.city <- SMCA(cheese, c1 = c1[3], c2 = c2[1], Gcol = Gvar, Grow = Gcity, n = 10, init="svd")
res.3.2.city <- SMCA(cheese, c1 = c1[3], c2 = c2[2], Gcol = Gvar, Grow = Gcity, n = 10, init="svd")
```

Sans Groupement sur les observations.
```{r}
res.1.1 <- SMCA(cheese, c1 = c1[1], c2 = c2[1], Gcol = Gvar, n = 10, init="svd")
res.1.2 <- SMCA(cheese, c1 = c1[1], c2 = c2[2], Gcol = Gvar, n = 10, init="svd")
res.1.3 <- SMCA(cheese, c1 = c1[1], c2 = c2[3], Gcol = Gvar, n = 10, init="svd")
res.2.1 <- SMCA(cheese, c1 = c1[2], c2 = c2[1], Gcol = Gvar, n = 10, init="svd")
res.2.2 <- SMCA(cheese, c1 = c1[2], c2 = c2[2], Gcol = Gvar, n = 10, init="svd")
res.2.3 <- SMCA(cheese, c1 = c1[2], c2 = c2[3], Gcol = Gvar, n = 10, init="svd")
res.3.1 <- SMCA(cheese, c1 = c1[3], c2 = c2[1], Gcol = Gvar, n = 10, init="svd")
res.3.2 <- SMCA(cheese, c1 = c1[3], c2 = c2[2], Gcol = Gvar, n = 10, init="svd")
res.3.3 <- SMCA(cheese, c1 = c1[3], c2 = c2[3], Gcol = Gvar, n = 10, init="svd")

```


```{r}
screeplot_new(res.1.1.city, sort.comp = F)
screeplot_new(res.3.1.city, sort.comp = F)

```

```{r}
res <- data.frame(res.1.1.city$eig$percentageOfVariance,
                  res.1.2.city$eig$percentageOfVariance,
                  res.1.3.city$eig$percentageOfVariance,
                  res.2.1.city$eig$percentageOfVariance,
                  res.2.2.city$eig$percentageOfVariance,
                  res.2.3.city$eig$percentageOfVariance,
                  res.3.1.city$eig$percentageOfVariance,
                  res.3.2.city$eig$percentageOfVariance)

names <- sapply(1:ncol(res), function(i) {substr(colnames(res)[i], 5, 12)})

screeplot_cum(res, names.res = names)


res2 <- data.frame(res.1.1$eig$percentageOfVariance,
                  res.1.2$eig$percentageOfVariance,
                  res.1.3$eig$percentageOfVariance,
                  res.2.1$eig$percentageOfVariance,
                  res.2.2$eig$percentageOfVariance,
                  res.2.3$eig$percentageOfVariance,
                  res.3.1$eig$percentageOfVariance,
                  res.3.2$eig$percentageOfVariance,
                  res.3.3$eig$percentageOfVariance)

names2 <- sapply(1:ncol(res2), function(i) {substr(colnames(res2)[i], 5, 7)})

screeplot_cum(res2, names.res = names2)
```
Affichage des individuals factor maps des analyses avec groupement par ville.
```{r}
p1.1 <- plot_SMCA(res.1.1.city, habillage = 3)+ theme(legend.position = "none")+ ggtitle("1.1")
p1.2 <- plot_SMCA(res.1.2.city, habillage = 3)+ theme(legend.position = "none")+ ggtitle("1.2")
p1.3 <- plot_SMCA(res.1.3.city, habillage = 3)+ theme(legend.position = "none")+ ggtitle("1.3")
p2.1 <- plot_SMCA(res.2.1.city, habillage = 3)+ theme(legend.position = "none")+ ggtitle("2.1")
p2.2 <- plot_SMCA(res.2.2.city, habillage = 3)+ theme(legend.position = "none")+ ggtitle("2.2")
p2.3 <- plot_SMCA(res.2.3.city, habillage = 3)+ theme(legend.position = "none")+ ggtitle("2.3")
p3.1 <- plot_SMCA(res.3.1.city, habillage = 3)+ theme(legend.position = "none")+ ggtitle("3.1")
p3.2 <- plot_SMCA(res.3.2.city, habillage = 3)+ theme(legend.position = "none")+ ggtitle("3.2")

ggarrange(p1.1, p1.2, p1.3, p2.1, p2.2, p2.3, p3.1, p3.2)

```


Affichage des individuals factor maps des analyses sans groupement par ville.
```{r}
p1.1 <- plot_SMCA(res.1.1, habillage = 3)+ theme(legend.position = "none")+ ggtitle("1.1")
p1.2 <- plot_SMCA(res.1.2, habillage = 3)+ theme(legend.position = "none")+ ggtitle("1.2")
p1.3 <- plot_SMCA(res.1.3, habillage = 3)+ theme(legend.position = "none")+ ggtitle("1.3")
p2.1 <- plot_SMCA(res.2.1, habillage = 3)+ theme(legend.position = "none")+ ggtitle("2.1")
p2.2 <- plot_SMCA(res.2.2, habillage = 3)+ theme(legend.position = "none")+ ggtitle("2.2")
p2.3 <- plot_SMCA(res.2.3, habillage = 3)+ theme(legend.position = "none")+ ggtitle("2.3")
p3.1 <- plot_SMCA(res.3.1, habillage = 3)+ theme(legend.position = "none")+ ggtitle("3.1")
p3.2 <- plot_SMCA(res.3.2, habillage = 3)+ theme(legend.position = "none")+ ggtitle("3.2")
p3.3 <- plot_SMCA(res.3.3, habillage = 3)+ theme(legend.position = "none")+ ggtitle("3.3")

ggarrange(p1.1, p1.2, p1.3, p2.1, p2.2, p2.3, p3.1, p3.2, p3.3)

```

Affichage des variables factor maps des analyses avec groupement par ville.
```{r}
p1.1 <- plot_SMCA(res.1.1.city, choix = "var", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("1.1")
p1.2 <- plot_SMCA(res.1.2.city, choix = "var", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("1.2")
p1.3 <- plot_SMCA(res.1.3.city, choix = "var", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("1.3")
p2.1 <- plot_SMCA(res.2.1.city, choix = "var", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("2.1")
p2.2 <- plot_SMCA(res.2.2.city, choix = "var", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("2.2")
p2.3 <- plot_SMCA(res.2.3.city, choix = "var", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("2.3")
p3.1 <- plot_SMCA(res.3.1.city, choix = "var", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("3.1")
p3.2 <- plot_SMCA(res.3.2.city, choix = "var", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("3.2")

ggarrange(p1.1, p1.2, p1.3, p2.1, p2.2, p2.3, p3.1, p3.2)

```

Affichage des variables factor maps des analyses sans groupement par ville.
```{r}
p1.1 <- plot_SMCA(res.1.1, choix = "var", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("1.1")
p1.2 <- plot_SMCA(res.1.2, choix = "var", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("1.2")
p1.3 <- plot_SMCA(res.1.3, choix = "var", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("1.3")
p2.1 <- plot_SMCA(res.2.1, choix = "var", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("2.1")
p2.2 <- plot_SMCA(res.2.2, choix = "var", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("2.2")
p2.3 <- plot_SMCA(res.2.3, choix = "var", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("2.3")
p3.1 <- plot_SMCA(res.3.1, choix = "var", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("3.1")
p3.2 <- plot_SMCA(res.3.2, choix = "var", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("3.2")
p3.3 <- plot_SMCA(res.3.3, choix = "var", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("3.3")

ggarrange(p1.1, p1.2, p1.3, p2.1, p2.2, p2.3, p3.1, p3.2, p3.3)

```

Affichage des categories factor maps des analyses avec groupement par ville.
```{r}
p1.1 <- plot_SMCA(res.1.1.city, choix = "mod", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("1.1")
p1.2 <- plot_SMCA(res.1.2.city, choix = "mod")+ theme(legend.position = "none")+ ggtitle("1.2")
p1.3 <- plot_SMCA(res.1.3.city, choix = "mod")+ theme(legend.position = "none")+ ggtitle("1.3")
p2.1 <- plot_SMCA(res.2.1.city, choix = "mod", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("2.1")
p2.2 <- plot_SMCA(res.2.2.city, choix = "mod")+ theme(legend.position = "none")+ ggtitle("2.2")
p2.3 <- plot_SMCA(res.2.3.city, choix = "mod")+ theme(legend.position = "none")+ ggtitle("2.3")
p3.1 <- plot_SMCA(res.3.1.city, choix = "mod", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("3.1")
p3.2 <- plot_SMCA(res.3.2.city, choix = "mod")+ theme(legend.position = "none")+ ggtitle("3.2")

ggarrange(p1.1, p1.2, p1.3, p2.1, p2.2, p2.3, p3.1, p3.2)

```

Affichage des categories factor maps des analyses sans groupement par ville.
```{r}
p1.1 <- plot_SMCA(res.1.1, choix = "mod", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("1.1")
p1.2 <- plot_SMCA(res.1.2, choix = "mod")+ theme(legend.position = "none")+ ggtitle("1.2")
p1.3 <- plot_SMCA(res.1.3, choix = "mod")+ theme(legend.position = "none")+ ggtitle("1.3")
p2.1 <- plot_SMCA(res.2.1, choix = "mod", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("2.1")
p2.2 <- plot_SMCA(res.2.2, choix = "mod")+ theme(legend.position = "none")+ ggtitle("2.2")
p2.3 <- plot_SMCA(res.2.3, choix = "mod")+ theme(legend.position = "none")+ ggtitle("2.3")
p3.1 <- plot_SMCA(res.3.1, choix = "mod", aff.noms = T)+ theme(legend.position = "none")+ ggtitle("3.1")
p3.2 <- plot_SMCA(res.3.2, choix = "mod")+ theme(legend.position = "none")+ ggtitle("3.2")
p3.3 <- plot_SMCA(res.3.3, choix = "mod")+ theme(legend.position = "none")+ ggtitle("3.3")

ggarrange(p1.1, p1.2, p1.3, p2.1, p2.2, p2.3, p3.1, p3.2, p3.3)

```

```{r}
# plot_SMCA(res.smca1, habillage = 3)
# plot_SMCA(res.smca1, habillage = 3, axes = c(3,4))
# 
# plot_SMCA(res.smca2, habillage = 3)
# plot_SMCA(res.smca2, habillage = 3, axes = c(3,4))
# 
# plot_SMCA(res.smca1, choix = "var", aff.noms = T) + theme(legend.position = "none")
# plot_SMCA(res.smca1, choix = "var", aff.noms = T,  axes = c(3,4)) + theme(legend.position = "none")
# 
# plot_SMCA(res.smca2, choix = "var", aff.noms = T) + theme(legend.position = "none")
# plot_SMCA(res.smca2, choix = "var", aff.noms = T,  axes = c(3,4)) + theme(legend.position = "none")
# 
# plot_SMCA(res.smca1, choix = "mod", aff.noms = T) + theme(legend.position = "none")
# plot_SMCA(res.smca1, choix = "mod", aff.noms = T,  axes = c(3,4)) + theme(legend.position = "none")
# 
# plot_SMCA(res.smca2, choix = "mod", aff.noms = T) + theme(legend.position = "none")
# plot_SMCA(res.smca2, choix = "mod", aff.noms = T,  axes = c(3,4)) + theme(legend.position = "none")
```
